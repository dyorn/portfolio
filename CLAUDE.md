# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

```bash
yarn dev              # Start local dev server (gatsby develop)
yarn build            # Production build with page logging
yarn serve            # Serve production build locally
yarn lint             # ESLint (JS/JSX, ignores public/)
yarn format           # Prettier (src/ and cdn/)
yarn generate-metadata  # Extract image metadata from CDN (node scripts/generate-image-metadata.js)
```

Package manager is **Yarn 4.10.2**. No test suite exists.

## Code Style

- No semicolons, single quotes, trailing commas (es5) â€” enforced by Prettier
- ESLint configured with React plugin, ES6/JSX support, babel-eslint parser

## Architecture

**Gatsby 4 static site** (React 17) deployed to **Netlify**. Content lives as markdown files in `content/` with YAML frontmatter, queried via Gatsby's GraphQL data layer.

### Content Types & Dynamic Pages (gatsby-node.js)

Three content types in `content/`, each with a `type` field in frontmatter and a corresponding template in `src/templates/`:

| Frontmatter `type` | Content dir | Route pattern | Template |
|---|---|---|---|
| `artboard` | `content/artboards/` | `/artboards/{slug}/` | `src/templates/artboard.js` |
| `photo-collection` | `content/photo_collections/` | `/photo_collections/{slug}/` | `src/templates/photo_collection.js` |
| `writing` | `content/writings/` | `/writings/{slug}/` | `src/templates/writing.js` |

### Data Sources (gatsby-config.js)

- **Filesystem**: Markdown content (`content/`) and static images (`src/images/`)
- **YouTube API**: Fetches latest 10 videos from channel
- **GitHub API**: Fetches 10 most recent repos with READMEs

All three require env vars in `.env.development` / `.env.production`: `YOUTUBE_API_KEY`, `GITHUB_API_KEY`, `GOOGLE_MEASUREMENT_ID`, `GATSBY_CDN_BASE_URL`.

### Image Pipeline

Images are hosted on **Cloudflare R2** and served through a CDN. The `CDNImage` component (`src/components/CDNImage.js`) handles responsive loading with dominant-color placeholders. Image metadata (aspect ratios, colors) is generated by `scripts/generate-image-metadata.js` and stored alongside content markdown files.

### Styling

**TailwindCSS 2** with PostCSS, purged via `gatsby-plugin-purgecss`. Custom theme colors: `themePurple` (#342e37), `themeBlue` (#0bbcd6), `themeRed` (#e4572e), `themeOffWhite` (#d6f8d6). Font: Manrope. Extensive custom utilities for 3D box-shadow effects defined in `tailwind.config.js`.

### Webpack Customizations (gatsby-node.js)

- Raw loader for shader files (`.glsl`, `.frag`, `.vert`, etc.)
- p5.js null-loaded during SSR (`build-html` stage) to avoid window reference errors

### Creative Code

`src/pages/code_art/` contains interactive art pieces using **Three.js** and **p5.js**. WebGL shaders live in `src/shaders/`. Helper modules in `src/helpers/` support audio analysis for visualizations.
