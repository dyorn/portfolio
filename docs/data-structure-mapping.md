# Data Structure Mapping: Contentful → Markdown

## Current Contentful Structure → Proposed Markdown Structure

### 1. Writings (contentfulWriting)

**Current Contentful Fields:**
```graphql
contentfulWriting {
  title
  slug  
  writingDate
  metadata
  body {
    raw                    # Rich text JSON
    references {           # Embedded assets/links
      ... on ContentfulAsset {
        contentful_id
        title
        description
        gatsbyImageData
      }
      ... on ContentfulWriting {
        contentful_id
        title
        slug
      }
    }
  }
}
```

**Proposed Markdown Structure:**
```markdown
---
title: "My Blog Post Title"
slug: "my-blog-post-title"
writingDate: "2023-10-27"
metadata: "Additional metadata"
type: "writing"
---

# My Blog Post Title

This is the body content converted from Contentful rich text to markdown.

![Image alt text](./images/image.jpg)

[Link to another writing](../other-post/index.md)
```

**File Location:** `content/writings/my-blog-post-title/index.md`

---

### 2. Artboards (contentfulArtboard)

**Current Contentful Fields:**
```graphql
contentfulArtboard {
  title
  slug
  artboardDate  
  metadata
  artboard {
    gatsbyImageData
  }
  description {
    childMarkdownRemark {
      htmlAst
    }
  }
}
```

**Proposed Markdown Structure:**
```markdown
---
title: "Artwork Title"
slug: "artwork-slug"
artboardDate: "2023-10-27"
metadata: "Artwork metadata"
type: "artboard"
artboard: "./artboard.jpg"
---

Description of the artwork in markdown format.
```

**File Location:** `content/artboards/artwork-slug/index.md`
**Image Location:** `content/artboards/artwork-slug/artboard.jpg`

---

### 3. Photo Collections (contentfulPhotoCollection) - FUTURE R2 READY

**Current Contentful Fields:**
```graphql
contentfulPhotoCollection {
  title
  slug
  collectionDate
  featuredImage {
    gatsbyImageData
  }
  # Additional fields need to be discovered
}
```

**Proposed Markdown Structure (R2-Ready):**
```markdown
---
title: "Collection Title"
slug: "collection-slug"  
collectionDate: "2023-10-27"
type: "photo-collection"
featuredImage: "./featured.jpg"
imageCount: 15
r2BaseUrl: "https://your-r2-domain.com/collections"
# Images will be: {r2BaseUrl}/{collection-slug}/1.jpg, /2.jpg, etc.
---

Description of the photo collection.
```

**File Location:** `content/photo-collections/collection-slug/index.md`
**Local Images (Interim):** `content/photo-collections/collection-slug/featured.jpg`
**R2 Images (Future):** `{collection-slug}/1.jpg`, `{collection-slug}/2.jpg`, etc.

---

### 4. Site Data (contentfulSiteData)

**Current Contentful Fields:**
```graphql
contentfulSiteData {
  featuredImage {
    gatsbyImageData
  }
  # Other site-wide configuration
}
```

**Proposed Structure:**
```markdown
---
type: "site-data"
featuredImage: "./profile-picture.jpg"
# Other site configuration
---

Site-wide content or description if needed.
```

**File Location:** `content/site-data/index.md`

---

## GraphQL Query Transformation

### Before (Contentful):
```graphql
query {
  allContentfulWriting {
    edges {
      node {
        title
        slug
        writingDate
        body {
          raw
          references { ... }
        }
      }
    }
  }
}
```

### After (Markdown):
```graphql
query {
  allMarkdownRemark(filter: { frontmatter: { type: { eq: "writing" } } }) {
    edges {
      node {
        frontmatter {
          title
          slug
          writingDate
          type
        }
        html
        fields {
          slug    # Generated by gatsby-node.js
        }
      }
    }
  }
}
```

---

## Rich Text Conversion Strategy

### Contentful Rich Text → Markdown

**Contentful Rich Text JSON:**
```json
{
  "nodeType": "document",
  "content": [
    {
      "nodeType": "paragraph",
      "content": [
        {
          "nodeType": "text",
          "value": "This is bold text",
          "marks": [{"type": "bold"}]
        }
      ]
    },
    {
      "nodeType": "embedded-asset-block",
      "content": [],
      "data": {
        "target": {
          "sys": {"id": "asset-id"}
        }
      }
    }
  ]
}
```

**Converted Markdown:**
```markdown
This is **bold text**

![Alt text](./images/asset-filename.jpg)
```

### Cross-Reference Handling

**Contentful Rich Text Reference:**
```json
{
  "nodeType": "entry-hyperlink",
  "data": {
    "target": {
      "sys": {"id": "entry-id"},
      "slug": "target-post-slug"
    }
  },
  "content": [{"nodeType": "text", "value": "Link text"}]
}
```

**Converted Markdown:**
```markdown
[Link text](../target-post-slug/index.md)
```

---

## Image Processing Strategy

1. **Download**: All Contentful assets downloaded to local folders
2. **Organization**: Images stored alongside their content
3. **Optimization**: Use `gatsby-transformer-sharp` for processing
4. **References**: Update all image references to local paths

### Before:
```graphql
featuredImage {
  gatsbyImageData(width: 500)
}
```

### After:
```graphql
featuredImage {
  childImageSharp {
    gatsbyImageData(width: 500)
  }
}
```

---

## File System Route Updates

### Current Routes (gatsby-node.js):
- `/writings/${slug}/` → `src/templates/writing.js`
- `/artboards/${slug}/` → `src/templates/artboard.js`  
- `/photo_collections/${slug}/` → `src/templates/photo_collection.js`

### New File System Routes:
- `src/pages/writings/{markdownRemark.frontmatter__slug}.js`
- `src/pages/artboards/{markdownRemark.frontmatter__slug}.js`
- `src/pages/photo-collections/{markdownRemark.frontmatter__slug}.js`

Or keep programmatic page creation in gatsby-node.js with markdown queries.

---

## Next: Implementation Details

Once you confirm this data structure mapping looks correct, we can proceed with detailed implementation of each transformation step.
